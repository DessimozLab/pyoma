import unittest
from .. import locus_parser as lp

class LocusParserTest(unittest.TestCase):
    
    def verifyResult(self, res, eNr, nr_exons, min_loc, max_loc, strand):
        self.assertEqual(res.shape, (nr_exons,))
        for x in res.EntryNr:
            self.assertEqual(x,eNr)
        self.assertEqual(res.Start.min(), min_loc)
        self.assertEqual(res.End.max(),max_loc)
        self.assertEqual(res[0].Strand, strand)

    def test_singleExonForward(self):
        s, eNr = '422..522', 22
        res = lp.parse(eNr, s)
        self.verifyResult(res, eNr, 1, 422, 522, 1)

    def test_singleExonReverse(self):
        s, eNr = 'complement(22..6232)', 21
        res = lp.parse(eNr, s)
        self.verifyResult(res, eNr, 1, 22, 6232, -1)

    def test_forward(self):
        s, eNr = 'join(23..15555,22432..66666)', 5
        res = lp.parse(eNr, s)
        self.verifyResult(res, eNr, 2, 23, 66666, 1)

    def test_reverse(self):
        s, eNr = 'join(complement(23..15555),complement(22432..66666))', 5
        res = lp.parse(eNr, s)
        self.verifyResult(res, eNr, 2, 23, 66666, -1)

    def test_before_and_after(self):
        s, eNr = 'join(Before(10)..40,33..After(66))', 8
        res = lp.parse(eNr, s)
        self.verifyResult(res, eNr, 2, 10, 66, 1)

    def test_complement_of_join(self):
        s, eNr = 'complement(join(1653679..1653924,1654352..1654354))', 333
        res = lp.parse(eNr, s)
        self.verifyResult(res, eNr, 2, 1653679, 1654354, -1)

    def test_huge(self):

        s, eNr = "join(1174265..1174355, 1178881..1179084, 1180046..1180333, 1181738..1181826, 1181919..1182163, 1185501..1185801, 1186022..1186174, 1186664..1186780, 1188317..1188473, 1188974..1189054, 1189186..1189226, 1190422..1190559, 1191014..1191151, 1193561..1193827, 1193948..1194073, 1195349..1195627, 1195944..1196009, 1196485..1196743, 1198381..1198441, 1198559..1198771, 1199556..1199698, 1200742..1200947, 1201081..1201311, 1201891..1202135, 1202360..1202416, 1202691..1202914, 1203018..1203182, 1203281..1203449, 1203982..1205672, 1205824..1206105, 1206383..1206649, 1206754..1207026, 1207140..1207403, 1207496..1207756, 1208137..1208397, 1208880..1209143, 1209249..1209509, 1209656..1209916, 1211012..1211272, 1211369..1211510, 1211597..1211762, 1212356..1212587, 1213383..1213667, 1213771..1213896, 1217624..1217812, 1223196..1223252, 1238244..1239107, 1239524..1239554, 1240062..1240215, 1240354..1240753, 1240796..1241480, 1241718..1241970, 1242013..1242328, 1243136..1243414, 1244538..1245104, 1245563..1245844, 1245942..1246220, 1246707..1246991, 1247088..1247366, 1247495..1247782, 1247901..1248179, 1248308..1248589, 1248689..1248967, 1249060..1249338, 1249455..1249733, 1249848..1250135, 1250254..1250532, 1250621..1250908, 1251016..1251294, 1251407..1251694, 1251803..1252081, 1252213..1252500, 1252757..1253035, 1253272..1253553, 1254161..1254439, 1254551..1254832, 1255520..1255798, 1255898..1256185, 1256410..1256688, 1256785..1257063, 1257157..1257435, 1257554..1257841, 1257969..1258256, 1259167..1259448, 1260451..1260729, 1260830..1261117, 1261226..1261504, 1261624..1261911, 1262064..1262348, 1262495..1262773, 1262878..1263156, 1263276..1263563, 1263701..1263988, 1265485..1265766, 1265974..1266252, 1266352..1266633, 1266724..1267002, 1267524..1267811, 1281619..1281897, 1281986..1282264, 1282356..1282634, 1283271..1283558, 1283709..1283996, 1284580..1284870, 1297808..1298095, 1299448..1299540, 1299658..1299940, 1300287..1300473, 1301181..1301270, 1301371..1301638, 1316151..1316411, 1317025..1317234, 1317336..1317413, 1317522..1317548, 1318429..1318476, 1320438..1320494, 1320611..1320688, 1322960..1323014, 1323723..1323988, 1325314..1325383, 1326019..1326107, 1326810..1326890, 1327499..1327582, 1327805..1327879, 1328112..1328189, 1328543..1328626, 1329154..1329237, 1329427..1329476, 1329824..1329908, 1330061..1330144, 1330445..1330504, 1331718..1331833, 1332029..1332099, 1332234..1332246, 1332356..1332458, 1332803..1332880, 1333096..1333157, 1333322..1333344, 1333816..1333866, 1334581..1334611, 1335713..1335762, 1335777..1335790, 1337059..1337142, 1337241..1337320, 1337664..1337706, 1338798..1338826, 1339275..1339338, 1339499..1339552, 1339792..1339866, 1339921..1339950, 1340466..1340594, 1340729..1340767, 1341030..1341128, 1341343..1341370, 1341402..1341444, 1341667..1341696, 1342174..1342270, 1342458..1342538, 1342824..1342907, 1343903..1343986, 1348670..1348753, 1348982..1349230, 1350353..1350372, 1351620..1351695, 1352380..1352463, 1352661..1352882, 1353024..1353137, 1353424..1353522, 1353850..1353960, 1354048..1354224, 1354839..1354922, 1355365..1355442, 1355646..1355729, 1355953..1356036, 1356141..1356167, 1356186..1356210, 1356236..1356562, 1356768..1356867, 1357302..1357383, 1358558..1358641, 1358856..1358939, 1359129..1359208, 1359886..1359970, 1361119..1361199, 1362116..1362199, 1362390..1362470, 1363944..1364027, 1364240..1364323, 1364585..1364668, 1364846..1364980, 1365231..1365314, 1367003..1367086, 1367321..1367434, 1367686..1367766, 1370518..1370601, 1370938..1371021, 1371289..1371372, 1371723..1371806, 1373581..1373664, 1375136..1375219, 1375484..1375564, 1375624..1375651, 1375826..1375932, 1376199..1376276, 1377242..1377319, 1378044..1378147, 1378438..1378510, 1378760..1378888, 1379162..1379245, 1380040..1380246, 1380614..1380709, 1381265..1381342, 1383330..1383410, 1385097..1385201, 1385786..1385863, 1386307..1386360, 1387127..1387219, 1392063..1392117, 1392945..1393348, 1393563..1393838, 1394594..1394869, 1395005..1395144, 1395661..1395787, 1395877..1396140, 1396246..1396512, 1397468..1397731, 1397826..1397965, 1398084..1398210, 1398320..1398586, 1398689..1398955, 1399598..1399864, 1399963..1400102, 1400988..1401114, 1402180..1402322, 1404882..1405005, 1405575..1405841, 1406005..1406102, 1406238..1406406, 1406503..1406769, 1406873..1407139, 1407231..1407509, 1407611..1408019, 1408137..1408261, 1408353..1408619, 1409910..1410179, 1410438..1410740, 1410853..1411155, 1411797..1411984, 1412079..1412193, 1412747..1413031, 1413248..1413399, 1413538..1413685, 1413806..1413983, 1414081..1414202, 1414295..1414588, 1414687..1414983, 1415089..1415275, 1417074..1417189, 1417285..1417584, 1418014..1418313, 1418402..1418507, 1419611..1419807, 1421540..1421845, 1421947..1422225, 1423346..1423645, 1423746..1424048, 1424151..1424525, 1424617..1424919, 1425686..1425985, 1426076..1426372, 1426481..1426765, 1426861..1427154, 1427655..1427954, 1428062..1428124, 1428139..1428339, 1428435..1428625, 1429835..1430264, 1430868..1431176, 1432496..1432644, 1432730..1432762, 1432851..1432980, 1433076..1433375, 1433464..1433577, 1433619..1433759, 1433868..1434164, 1434265..1434564, 1435122..1435436, 1435534..1435682, 1438069..1438219, 1438306..1438587, 1438691..1438993, 1439079..1439381, 1439498..1439779, 1440263..1440565, 1440654..1440956, 1441046..1441354, 1441441..1441722, 1442302..1442601, 1442755..1443048, 1443146..1446112, 1446219..1446539, 1446650..1446934, 1447153..1447452, 1448095..1448397, 1449155..1449430, 1449533..1449832, 1449920..1450222, 1450573..1450872, 1451004..1451291, 1451383..1451679, 1451763..1452065, 1452173..1452478, 1453283..1453576, 1453680..1453970, 1454075..1454362, 1454541..1455131, 1455222..1455326, 1455823..1456020, 1456109..1456405, 1456515..1457102, 1457197..1457499, 1457617..1474722, 1475013..1475309, 1475416..1476003, 1476093..1476396, 1476472..1476773, 1477714..1478001, 1478556..1478855, 1478953..1479255, 1479382..1479687, 1479785..1481554, 1481663..1481959, 1483421..1483708, 1483808..1484107, 1484193..1486259, 1486350..1486658, 1487067..1487372, 1487462..1487752, 1487884..1488183, 1488288..1488593, 1488864..1489169, 1489272..1489553, 1489863..1490456, 1490553..1490840, 1490951..1491250, 1491738..1492040, 1492357..1492659, 1492755..1493339, 1493470..1493775, 1493880..1494179, 1494414..1494998, 1495088..1495393, 1495483..1496076, 1496198..1502151, 1502245..1502398, 1503550..1503837, 1503969..1504267)", 6213345    
        res = lp.parse(eNr, s)
        self.verifyResult(res, eNr, 22, 1174265, 1504267, 1) 
